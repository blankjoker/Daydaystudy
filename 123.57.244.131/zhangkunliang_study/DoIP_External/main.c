
#include <stdio.h>
#include <string.h>
#include "ne_doip_util.h"
#include "ne_doip_thread.h"
#include "ne_doip_os.h"
#include "ne_doip_select.h"
#include "ne_doip_event_loop.h"
#include "ne_doip_timer.h"
#include "ne_doip_connection.h"


#define protocol_version 0x02
#define inverset_protocol_version 0xFD


char DoIPTest_Vehicle_Identity_Request[8] =
{
    protocol_version, 0xFD, 0x00, 0x01, 0x00,
    0x00, 0x00, 0x00
};
char DoIPTest_Vehicle_Identity_Response[40] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x04, 0x00,
    0x00, 0x00, 0x20, 0x49, 0x56,
    0x49, 0x38, 0x38, 0x41, 0x42,
    0x43, 0x44, 0x31, 0x39, 0x38,
    0x30, 0x30, 0x34, 0x31, 0x38,
    0x00, 0x03, 0x18, 0x03, 0x73,
    0xCB, 0x6B, 0x33, 0x18, 0x03,
    0x73, 0xCB, 0x6B, 0x33, 0x00
};


char DoIPTest_Vehicle_Identity_Vin_Request[25] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x03, 0x00,
    0x00, 0x00, 0x11, 0x49, 0x56,
    0x49, 0x38, 0x38, 0x41, 0x42,
    0x43, 0x44, 0x31, 0x39, 0x38,
    0x30, 0x30, 0x34, 0x31, 0x38
};
char DoIPTest_Vehicle_Identity_Vin_Response[40] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x04, 0x00,
    0x00, 0x00, 0x20, 0x49, 0x56,
    0x49, 0x38, 0x38, 0x41, 0x42,
    0x43, 0x44, 0x31, 0x39, 0x38,
    0x30, 0x30, 0x34, 0x31, 0x38,
    0x00, 0x03, 0x18, 0x03, 0x73,
    0xCB, 0x6B, 0x33, 0x18, 0x03,
    0x73, 0xCB, 0x6B, 0x33, 0x00
};


char DoIPTest_Vehicle_Identity_Eid_Request[14] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x02, 0x00,
    0x00, 0x00, 0x06, 0x18, 0x03,
    0x73, 0xCB, 0x6B, 0x33
};
char DoIPTest_Vehicle_Identity_Eid_Response[40] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x04, 0x00,
    0x00, 0x00, 0x20, 0x49, 0x56,
    0x49, 0x38, 0x38, 0x41, 0x42,
    0x43, 0x44, 0x31, 0x39, 0x38,
    0x30, 0x30, 0x34, 0x31, 0x38,
    0x00, 0x03, 0x18, 0x03, 0x73,
    0xCB, 0x6B, 0x33, 0x18, 0x03,
    0x73, 0xCB, 0x6B, 0x33, 0x00
};


char DoIPTest_Vehicle_Power_Mode_Request[8] =
{
    protocol_version, inverset_protocol_version, 0x40, 0x03, 0x00,
    0x00, 0x00, 0x00
};
char DoIPTest_Vehicle_Power_Mode_Response[9] =
{
    protocol_version, inverset_protocol_version, 0x40, 0x04, 0x00,
    0x00, 0x00, 0x01, 0x01
};


char DoIPTest_Vehicle_Entity_Status_Request[8] =
{
    protocol_version, inverset_protocol_version, 0x40, 0x01, 0x00,
    0x00, 0x00, 0x00
};
char DoIPTest_Vehicle_Entity_Status_Response[15] =
{
    protocol_version, inverset_protocol_version, 0x40, 0x02, 0x00,
    0x00, 0x00, 0x07, 0x00, 0xFF,
    0x00, 0x00, 0x1E, 0xD2, 0xA0
};


char DoIPTest_Vehicle_Routing_Activation_Request[15] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x01,
    0x00, 0x00, 0x00, 0x00, 0x00
};
char DoIPTest_Vehicle_Routing_Activation_Response[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x10, 0x00, 0x00,
    0x00, 0x00
};
char DoIPTest_Vehicle_Routing_Activation_NACK_Code_00[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x00, 0x00, 0x00,
    0x00, 0x00
};
char DoIPTest_Vehicle_Routing_Activation_NACK_Code_01[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x01, 0x00, 0x00,
    0x00, 0x00
};
char DoIPTest_Vehicle_Routing_Activation_NACK_Code_02[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x02, 0x00, 0x00,
    0x00, 0x00
};
char DoIPTest_Vehicle_Routing_Activation_NACK_Code_03[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x03, 0x00, 0x00,
    0x00, 0x00
};
char DoIPTest_Vehicle_Routing_Activation_NACK_Code_04[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x04, 0x00, 0x00,
    0x00, 0x00
};
char DoIPTest_Vehicle_Routing_Activation_NACK_Code_06[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x06, 0x00, 0x00,
    0x00, 0x00
};


char DoIPTest_Vehicle_Diagnostic_Request[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0E, 0x01,
    0x00, 0x01, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_Vehicle_Diagnostic_Response[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x00, 0x01,
    0x0E, 0x01, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_Vehicle_Diagnostic_Function_Request[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0E, 0x01,
    0xE4, 0x00, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_Vehicle_Diagnostic_Positive[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x02, 0x00,
    0x00, 0x00, 0x05, 0x00, 0x01,
    0x0E, 0x01, 0x00
};
char DoIPTest_Vehicle_Diagnostic_Negative_Code_02[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x03, 0x00,
    0x00, 0x00, 0x05, 0x00, 0x01,
    0x0E, 0x01, 0x02
};


char DoIPTest_Vehicle_Alive_Check_Request[8] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x07, 0x00,
    0x00, 0x00, 0x00
};
char DoIPTest_Vehicle_Alive_Check_Response[10] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x08, 0x00,
    0x00, 0x00, 0x02, 0x0E, 0x01
};


char DoIPTest_Header_NACK_Code_00[9] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x00
};


char DoIPTest_Header_NACK_Code_01[9] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x01
};


char DoIPTest_Header_NACK_Code_04[9] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x04
};


char DoIPTest_103_req[8] =
{
    0xFF, 0x00, 0x00, 0x01, 0x00,
    0x00, 0x00, 0x00
};


char DoIPTest_104_req[8] =
{
    0x01, 0xFD, 0x00, 0x01, 0x00,
    0x00, 0x00, 0x00
};


char DoIPTest_105_req[9] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00
};


char DoIPTest_106_req[15] =
{
    0x01, 0xFD, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x01,
    0x00, 0x00, 0x00, 0x00, 0x00
};

char DoIPTest_107_req[8] =
{
    0x01, 0xFE, 0x00, 0x01, 0x00,
    0x00, 0x00, 0x00
};


char DoIPTest_108_req[8] =
{
    protocol_version, inverset_protocol_version, 0x11, 0x11, 0x00,
    0x00, 0x00, 0x00
};


char DoIPTest_109_req[15] =
{
    protocol_version, inverset_protocol_version, 0x11, 0x11, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x01,
    0x00, 0x00, 0x00, 0x00, 0x00
};


char DoIPTest_110_req[14] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x02, 0x00,
    0x00, 0x00, 0x05, 0x18, 0x03,
    0x73, 0xCB, 0x6B, 0x33
};


char DoIPTest_204_req[14] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x02, 0x00,
    0x00, 0x00, 0x06, 0x18, 0x03,
    0x73, 0xBB, 0xBB, 0x33
};


char DoIPTest_205_req[25] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x03, 0x00,
    0x00, 0x00, 0x11, 0x49, 0x56,
    0x49, 0x38, 0x38, 0x41, 0x42,
    0x43, 0x44, 0x31, 0x39, 0x38,
    0x30, 0x30, 0xDD, 0xDD, 0xDD
};


char DoIPTest_303_req[15] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0D, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00
};
char DoIPTest_303_res[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0D, 0x00,
    0x00, 0x03, 0x00, 0x00, 0x00,
    0x00, 0x00
};


char DoIPTest_305_req[15] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x02,
    0x00, 0x00, 0x00, 0x00, 0x00
};
char DoIPTest_305_res[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x02,
    0x00, 0x03, 0x01, 0x00, 0x00,
    0x00, 0x00
};


char DoIPTest_307_req[15] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x02,
    0x00, 0x00, 0x00, 0x00, 0x00
};
char DoIPTest_307_res[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x02,
    0x00, 0x03, 0x02, 0x00, 0x00,
    0x00, 0x00
};


char DoIPTest_311_req[15] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x01,
    0xDD, 0x00, 0x00, 0x00, 0x00
};
char DoIPTest_311_res[17] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x06, 0x00,
    0x00, 0x00, 0x09, 0x0E, 0x01,
    0x00, 0x03, 0x06, 0x00, 0x00,
    0x00, 0x00
};


char DoIPTest_405_req[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0D, 0x00,
    0x00, 0x01, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_405_res[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x03, 0x00,
    0x00, 0x00, 0x05, 0x00, 0x01,
    0x0D, 0x00, 0x02
};


char DoIPTest_406_res[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x03, 0x00,
    0x00, 0x00, 0x05, 0x00, 0x01,
    0x0E, 0x01, 0x06
};


char DoIPTest_407_req[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0E, 0x01,
    0x01, 0x33, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_407_res[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x03, 0x00,
    0x00, 0x00, 0x05, 0x01, 0x33,
    0x0E, 0x01, 0x03
};


char DoIPTest_409_req[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0E, 0x01,
    0x01, 0x44, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_409_res[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x03, 0x00,
    0x00, 0x00, 0x05, 0x01, 0x44,
    0x0E, 0x01, 0x03
};


char DoIPTest_902_req[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0E, 0x01,
    0xE4, 0x01, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};


char DoIPTest_902_res[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x02, 0x00,
    0x00, 0x00, 0x05, 0x01, 0x30,
    0x0E, 0x01, 0x00
};



char DoIPTest_903_req[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0E, 0x01,
    0xE0, 0x00, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_903_res[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x03, 0x00,
    0x00, 0x00, 0x05, 0xE0, 0x00,
    0x0E, 0x01, 0x03
};


char DoIPTest_904_req[18] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x01, 0x00,
    0x00, 0x00, 0x0A, 0x0D, 0x00,
    0xE4, 0x00, 0x01, 0x02, 0x03,
    0x04, 0x05, 0x06
};
char DoIPTest_904_res[13] =
{
    protocol_version, inverset_protocol_version, 0x80, 0x03, 0x00,
    0x00, 0x00, 0x05, 0xE4, 0x00,
    0x0D, 0x00, 0x02
};

char DoIPTest_1101_res[15] =
{
    protocol_version, inverset_protocol_version, 0x40, 0x02, 0x00,
    0x00, 0x00, 0x07, 0x01, 0xFF,
    0x00, 0x00, 0x1E, 0xD2, 0xA0
};


char DoIPTest_1104_req[15] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x01,
    0x00, 0x12, 0x34, 0x56, 0x78
};

char DoIPTest_1106_req[15] =
{
    protocol_version, inverset_protocol_version, 0x00, 0x05, 0x00,
    0x00, 0x00, 0x07, 0x0E, 0x01,
    0x00, 0x32, 0x40, 0x00, 0x00
};


// ne_doip_debug_testcase>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

char power_mode_true[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x01
};
char power_mode_false[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x02
};
char activation_line_true[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x03
};
char activation_line_false[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x04
};
char vehicle_announce[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x05
};
char vehicle_announce_other_ports[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x06
};
char routing_activation_auth_true[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x07
};
char routing_activation_auth_false[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x08
};
char entity_type_node[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x09
};
char entity_type_gateway[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x0A
};
char entity_type_mcts_1[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x0B
};
char entity_type_mcts_255[9] =
{
    0x02, 0xFD, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x0C
};

int32_t
ne_doip_ipv4_tcp_create(char *ip, uint16_t port)
{
    printf("ne_doip_ipv4_tcp_create enter! ip is [%s], port is [%d]\n", ip, port);

    if (ip == NULL) {
        printf("ne_doip_ipv4_tcp_create ip == NULL\n");
        return -1;
    }

    int32_t fd;
    struct sockaddr_in addr;
    memset(&addr, 0, sizeof addr);

    fd = ne_doip_os_socket(AF_INET, SOCK_STREAM, 0);
    if (fd < 0) {
        return -1;
    }

    addr.sin_family = AF_INET;
    addr.sin_port = htons(port);
    addr.sin_addr.s_addr = inet_addr(ip);

    errno = 0;
    const int32_t opt = 1;
    if (setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof opt)) {
        close(fd);
        fd = -1;
        printf("ne_doip_ipv4_tcp_create setsockopt SO_REUSEADDR error code:%d, message:%s\n", errno, strerror(errno));
        return fd;
    }


    int32_t ret = ne_doip_os_connect(fd, (struct sockaddr *) &addr, sizeof addr);
    if (ret < 0) {
        printf("ne_doip_ipv4_tcp_create connect error code:%d, message:%s\n", errno, strerror(errno));
        close(fd);
        fd = -1;
        return fd;
    }

    ne_doip_client_t *client;
    client = ne_doip_client_create(server, server->sel_net, fd);
    if (!client) {
        close(fd);
        fd = -1;
        return fd;
    }

    client->client_type = NE_DOIP_CLIENT_TYPE_TEST;

    ne_doip_sync_start(server->test_list_sync);
    ne_doip_list_insert(server->test_client_list->prev, (ne_doip_list_t *) client);
    ne_doip_sync_end(server->test_list_sync);
    /* client must create completely first
       source adding into I/O event notification must be last step! */
    if (ne_doip_source_add(server->sel_net, client->source, NE_DOIP_EVENT_READABLE) < 0) {
        printf("doip_test_tcp_create source add error!\n");
        ne_doip_list_remove((ne_doip_list_t *)client);
        free(client->connection);
        free(client->source);
        free(client);
        close(fd);
        return -1;
    }

    return fd;
}


void testcase_001()
{

}

void testcase_002()
{
    
}

void testcase_003()
{
    
}

void testcase_004()
{
    
}

void testcase_005()
{
    
}


int main(int argc, char const *argv[])
{
    /* code */
    printf(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n");
    return 0;
}